<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
  <style>
    .product-li {
      display: flex;
      flex-direction: column;
    }
    button {
      align-self: flex-start;
    }
  </style>
</head>
<body>
  <main>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#cartModal">
      查看購物車
    </button>
    <div class="container">
      <ul class="row product-list">

      </ul>
    </div>
  </main>


  <!-- Modal -->
  <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">購物車內容</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body cart-list">
          
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="clearCartBtn">清空購物車</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script>
    class Product {
      constructor(id, name, price, description, image, listElement) {
        this.id = id;
        this.name = name;
        this.price = price;
        this.description = description;
        this.image = image;
        this.productList = document.querySelector(listElement);
        this.render();
      }
      render() {
        const productLi = document.createElement("li");
        const productId = document.createElement("p");
        const productName = document.createElement("p");
        const productPrice = document.createElement("p");
        const productDescription = document.createElement("p");
        const productImage = document.createElement("img");
        const productBtn = document.createElement("button");
        productLi.className = "product-li col-4 border mb-5 py-3";
        productId.textContent = `編號: ${this.id}`;
        productName.textContent = `名稱: ${this.name}`;
        productPrice.textContent = `價錢: ${this.price}`;
        productDescription.textContent = `描述: ${this.description}`;
        productImage.src = this.image;
        productImage.className = "img-fluid mt-auto";
        productBtn.textContent = "加入購物車";
        productBtn.className = "btn btn-primary";
        productBtn.addEventListener("click", () => {
          Cart.addProduct(this);
          console.log(Cart.cart)
        })
        this.productList.append(productLi);
        productLi.append(productId, productName, productPrice, productDescription, productImage, productBtn);
      }
    }

    class Cart {
      static cart = [];
      static addProduct(product) {
        if(Cart.cart.some(item => item.id === product.id)) return;
        Cart.cart.push(product);
      }
      static renderCart() {
        const cartList = document.querySelector(".cart-list");
        cartList.innerHTML = "";
        Cart.cart.forEach(item => {
          const cart = document.createElement("div");
          const imageContainer = document.createElement("div");
          const image = document.createElement("img");
          const textContainer = document.createElement("div");
          const id = document.createElement("p");
          const name = document.createElement("p");
          const price = document.createElement("p");
          cart.className = "d-flex";
          imageContainer.className = "w-50";
          image.src = item.image;
          image.className = "img-fluid";
          id.textContent = `編號: ${item.id}`;
          name.textContent = `名稱: ${item.name}`;
          price.textContent = `價錢: ${item.price}`;
          cartList.append(cart);
          cart.append(imageContainer, textContainer);
          imageContainer.append(image);
          textContainer.append(id, name, price);
        })
      }

      static clearCart() {
        Cart.cart.length = 0;
        Cart.renderCart();
      }
    }
    const clearCartBtn = document.querySelector("#clearCartBtn");
    clearCartBtn.addEventListener("click", Cart.clearCart);

    const cartModal = document.querySelector('#cartModal');
    cartModal.addEventListener('show.bs.modal', event => {
      const cartList = document.querySelector(".cart-list");
      cartList.innerHTML = "";
      Cart.renderCart();
    })

    const renderProduct = (products) => {
      products.forEach(product => {
        const { id, name, price, description, image } = product;
        new Product(id, name, price, description, image, ".product-list");
      });
    }

    const getProductInfo = async () => {
      try {
        const res = await fetch("https://raw.githubusercontent.com/a41522001/product/refs/heads/main/product.json");
        const resData = await res.json();
        console.log(resData);
        renderProduct(resData);
      } catch (error) {
        console.error(error);
      }
    }

    getProductInfo();
  </script>
</body>
</html>